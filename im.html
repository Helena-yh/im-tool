<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>IM</title>
    <link rel="stylesheet" href="im.css">
</head>

<body>
    <div id="rcs-app"></div>
</body>

<script src="libs/RongIMLib.js"></script>
<script src="libs/RongEmoji-2.2.8.js"></script>

<script src="./libs/utils.js"></script>
<script src="./libs/qiniu-upload.js"></script>

<script src="./template.js"></script>
<script src="./emoji.js"></script>
<script src="./im.js"></script>

<!-- 实例化 -->
<script>
    var appKey = "8w7jv4qb82uyy";
    // 通过 url 选取用户
    var queryString = location.search;
    var userId = queryString.substring(1, queryString.length);
    function init(token) {
        RCS.init({
            appKey: appKey,
            token: token,
            userId:userId,
            target: document.getElementById('rcs-app'),
            showConversitionList: true,
            templates: 'templates/main.html'
        });
    }

    function getToken(id) {
        var ajax = new XMLHttpRequest();
        ajax.onreadystatechange = function () {
            if (ajax.readyState == 4 && ajax.status == 200) {
                let res = JSON.parse(ajax.responseText);
                if (res.code == 200) {
                    let token = res.result.token;
                    init(token);
                    return;
                }
                alert('token 获取失败');
            }
        }
        ajax.open("POST", "http://10.12.8.84:8586/user/get_token", true);//true异步请求，false同步
        ajax.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        ajax.send('{"id":' + id + '}');
    }

    (function () {

        getToken(userId);
    })()
</script>

</html>